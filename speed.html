<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speed</title>
</head>
<body>
    <h3 id="output">XXX</h3>
    <h4 id="count"></h4>
</body>

<script>

let output = document.getElementById('output')
let count = document.getElementById('count')
let countVal = 0

    // Function to calculate speed between two points
function calculateSpeed(lat1, lon1, time1, lat2, lon2, time2) {
    // Convert latitude and longitude from degrees to radians
    var R = 6371; // Radius of the earth in km
    var dLat = (lat2 - lat1) * Math.PI / 180;
    var dLon = (lon2 - lon1) * Math.PI / 180;
    var a = 
        Math.sin(dLat/2) * Math.sin(dLat/2) +
        Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
        Math.sin(dLon/2) * Math.sin(dLon/2)
        ; 
    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
    var distance = R * c * 1000; // Distance in meters
    var timeDiff = time2 - time1; // Time difference in milliseconds
    var speed = distance / timeDiff * 1000; // Speed in meters per second
    return speed;
}

// Function to handle the success of geolocation
function success(position) {
    if (position.coords.speed !== null) {
        output.innerText = "Current speed: " + position.coords.speed + " meters per second";
        // Number of time this function ran. Times Position changed.
        countVal += 1;
        count.innerText = `POS Change: ${countVal}`;
    } else {
        output.innerText = "Speed information is not available";
    }
}

// Function to handle errors in geolocation
function error(err) {
    output.innerText = 'ERROR(' + err.code + '): ' + err.message;
}

// Options for geolocation
var options = {
    enableHighAccuracy: true,
    maximumAge: 0
};

// Get the user's current position
// Watch the user's position continuously
var watchId = navigator.geolocation.watchPosition(success, error, options);

</script>

</html>