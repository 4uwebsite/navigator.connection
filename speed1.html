<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Speedometer</title>
<style>
    body {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
        background-color: #1f1f1f;
        color: #ffffff;
    }
    #container {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
    }
    #speed {
        font-size: 5em;
        margin-bottom: 20px;
    }
    #speedInfo {
        font-size: 1.5em;
        margin-bottom: 10px;
    }
</style>
</head>
<body>
<div id="container">
    <div id="speed">0.000</div>
    <div id="speedInfo">Position changes: 0</div>
    <div id="position"></div>
</div>

<script>
    var previousPosition = null;
    var positionChanges = 0;

    function calculateSpeed(lat1, lon1, time1, lat2, lon2, time2) {
        var R = 6371; // Radius of the earth in km
        var dLat = (lat2 - lat1) * Math.PI / 180;
        var dLon = (lon2 - lon1) * Math.PI / 180;
        var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);
        var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
        var distance = R * c * 1000; // Distance in meters
        var timeDiff = (time2 - time1) / 1000; // Time difference in seconds
        var speedMps = distance / timeDiff; // Speed in meters per second
        var speedKmph = speedMps * 3.6; // Convert speed to km/h
        return speedKmph.toFixed(3); // Round speed to 3 decimal points
    }

    function success(position) {
        var speedElement = document.getElementById('speed');
        var speedInfoElement = document.getElementById('speedInfo');
        var positionElement = document.getElementById('position');

        if (previousPosition) {
            var speed = calculateSpeed(
                previousPosition.coords.latitude,
                previousPosition.coords.longitude,
                previousPosition.timestamp,
                position.coords.latitude,
                position.coords.longitude,
                position.timestamp
            );
            speedElement.textContent = speed;
            document.title = "Speed: " + speed + " km/h";

            if (speed > 0) {
                speedElement.style.color = "#ffbf00"; // Yellow
            } else {
                speedElement.style.color = "#ffffff"; // White
            }

            if (speed > 10) {
                speedElement.style.color = "#4caf50"; // Green
            }

            if (speed > 35) {
                speedElement.style.color = "#2196f3"; // Blue
            }

            if (speed > 50) {
                speedElement.style.color = "#f44336"; // Red
            }
        }

        positionChanges++;
        speedInfoElement.textContent = "Position changes: " + positionChanges;

        var positionText = "Latitude: " + position.coords.latitude.toFixed(6) + ", Longitude: " + position.coords.longitude.toFixed(6);
        positionElement.textContent = positionText;

        previousPosition = position;
    }

    function error(err) {
        console.warn('ERROR(' + err.code + '): ' + err.message);
    }

    var options = {
        enableHighAccuracy: true,
        maximumAge: 0
    };

    navigator.geolocation.watchPosition(success, error, options);
</script>

</body>
</html>
